{
    # Global options
    admin off
    email admin@infiniteminds.cc
    log {
        output file /var/log/caddy_access.log
        level info
    }
}

# Redirect HTTP to HTTPS
http://infiniteminds.cc, http://app.infiniteminds.cc {
    redir https://{host}{uri}
}

# HTTPS Configuration
https://infiniteminds.cc, https://app.infiniteminds.cc {
    tls /ssl/infiniteminds.cc.pem /ssl/infiniteminds.cc.key {
        # Added fallback for certificate management
        on_demand
    }

    header {
        Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
        X-Content-Type-Options "nosniff"
        X-Frame-Options "DENY"
        Referrer-Policy "no-referrer-when-downgrade"
        Content-Security-Policy "default-src 'self'"
    }

    # AWSBotService routing
    handle /s3* {
        reverse_proxy https://awsbotservice.railway.internal https://awsbotservice-finalproduction.up.railway.app:8080 {
            transport http {
                tls_insecure_skip_verify
            }
        }
    }

    # Go Service routing
    handle /skills* {
        reverse_proxy https://go-service.railway.internal https://go-service-finalproduction.up.railway.app:8080 {
            transport http {
                tls_insecure_skip_verify
            }
        }
    }

    handle /db-supported-skills* {
        reverse_proxy https://go-service.railway.internal https://go-service-finalproduction.up.railway.app:8080 {
            transport http {
                tls_insecure_skip_verify
            }
        }
    }

    handle /add-skill* {
        reverse_proxy https://go-service.railway.internal https://go-service-finalproduction.up.railway.app:8080 {
            transport http {
                tls_insecure_skip_verify
            }
        }
    }

    handle /supported-skills* {
        reverse_proxy https://go-service.railway.internal https://go-service-finalproduction.up.railway.app:8080 {
            transport http {
                tls_insecure_skip_verify
            }
        }
    }

    handle /skills/search* {
        reverse_proxy https://go-service.railway.internal https://go-service-finalproduction.up.railway.app:8080 {
            transport http {
                tls_insecure_skip_verify
            }
        }
    }

    handle /health {
        reverse_proxy https://go-service.railway.internal https://go-service-finalproduction.up.railway.app:8080 {
            transport http {
                tls_insecure_skip_verify
            }
        }
    }

    # SithBotModeManagerService routing
    handle /mode* {
        reverse_proxy {
            to https://sithbotmodemanagerservice.railway.internal
            to https://sithbotmodemanagerservice-finalproduction.up.railway.app:8080
            transport http {
                tls_insecure_skip_verify
            }
        }
    }

    # SithPythonServices routing
    handle /memory* {
        reverse_proxy https://sithpythonservices.railway.internal https://sithpythonservices-finalproduction.up.railway.app:8000 {
            transport http {
                tls_insecure_skip_verify
            }
        }
    }

    # SithGoServices routing
    handle /go* {
        reverse_proxy {
            to https://sithgoservices.railway.internal
            to https://sithgoservices-finalproduction.up.railway.app:8080
            transport http {
                tls_insecure_skip_verify
            }
        }
    }

    # Static file serving
    handle {
        root * /var/www/html
        file_server
    }

    # Error handling
    handle_errors {
        rewrite * /error.html
        file_server
    }
}
